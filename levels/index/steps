title = Aggiungere modifiche passo per passo
cards = add reset-file commit

[description]

L'index e' davvero utile, perche' ci permette di essere precisi su quali modifiche vogliamo includere in ogni commit!

[setup]

echo "Un martello in equilibrio sul manico." > martello
echo "Una bottiglia con un liquido trasparente." > bottiglia
echo "Una zolletta di zucchero bianca." > zolletta_zucchero

git add .
git commit -m "L'inizio"

[win]

# Fai modifiche a tutti e tre gli oggetti, per creare una sequenza logica di eventi!
test "$(git diff --name-only | wc -l)" -eq 3 || file -f .git/candle-changed && touch .git/candle-changed

# Aggiungi solo una di queste modifiche!
test "$(git diff --cached --name-only | wc -l)" -eq 1 || file -f .git/candle-added && touch .git/candle-added

# E fai un commit.
COUNT=0
for commit in $(git cat-file --batch-check='%(objectname) %(objecttype)' --batch-all-objects | grep 'commit$' | cut -f1 -d' '); do
    if test "$(git diff --name-only $commit $commit^ | wc -l)" -eq 1; then
        COUNT=$((COUNT+1))
    fi
done

test "$COUNT" -ge 1

# Fai un secondo commit che registri solo una modifica.
COUNT=0
for commit in $(git cat-file --batch-check='%(objectname) %(objecttype)' --batch-all-objects | grep 'commit$' | cut -f1 -d' '); do
    if test "$(git diff --name-only $commit $commit^ | wc -l)" -eq 1; then
        COUNT=$((COUNT+1))
    fi
done

test "$COUNT" -ge 2

# E un terzo commit.
COUNT=0
for commit in $(git cat-file --batch-check='%(objectname) %(objecttype)' --batch-all-objects | grep 'commit$' | cut -f1 -d' '); do
    if test "$(git diff --name-only $commit $commit^ | wc -l)" -eq 1; then
        COUNT=$((COUNT+1))
    fi
done

test "$COUNT" -ge 3
